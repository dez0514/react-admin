import{m as P,e as R,f as N,r as n,a as l,j as s,P as q,b as B,B as h,T as _,I as j,h as A,i as z,k as H,d as V,l as G,n as J,o as K,S as Q,p as W}from"./index-b193a4aa.js";import{T as X}from"./typingCard-0a4fd682.js";import{M as Y,F as Z,D as $,P as ee,a as se}from"./FormOutlined-7b490f4d.js";function ne(){const[p,y]=P.useMessage(),b="在这里，你可以对系统中的用户进行管理，例如添加一个新用户，或者修改系统中已经存在的用户。",{userinfo:I}=R(t=>t.userReducer),S=N(),[C,L]=n.useState([]),[M,T]=n.useState([]),[F,d]=n.useState(!1),[c,g]=n.useState(!1),[v,r]=n.useState(!1),[o]=l.useForm(),m=(t=!1)=>{z().then(e=>{if(e.code===0&&(L(e.data.map((a,i)=>({key:String(i),...a}))),t)){const a=e.data.find(i=>i.id===I.id);a&&S(H(a))}})},w=()=>{V().then(t=>{if(t.code===0){const e=t.data.map((a,i)=>({key:String(i),value:a.name,label:a.name}));T(e)}})},k=(t=!1,e)=>{if(d(!0),g(t),e){const{id:a,name:i,role:f,description:u}=e;o.setFieldsValue({id:a,name:i,role:f,description:u})}},D=()=>{console.log(o),o.validateFields().then(t=>{r(!0);const{id:e,name:a,role:i,description:f}=t,u={id:e||"",name:a||"",role:i||"",description:f||""};c?G(u).then(x=>{r(!1),x.code===0&&(p.success("修改成功"),d(!1),m(!0))}).catch(()=>{r(!1)}):J(u).then(x=>{r(!1),x.code===0&&(p.success("新增成功"),d(!1),m())}).catch(()=>{r(!1)})})},O=()=>{d(!1),g(!1),o.resetFields()},U=t=>{W({id:t.id}).then(e=>{e.code===0&&(p.success("删除成功"),m())})};n.useEffect(()=>{m(),w()},[]);const E=[{title:"头像",key:"avatar",render:(t,{avatar:e})=>s.jsx("img",{className:"tw-w-[40px]",src:e})},{title:"用户ID",key:"id",dataIndex:"id"},{title:"用户名称",key:"name",dataIndex:"name"},{title:"用户角色",key:"role",render:(t,{role:e})=>s.jsx(K,{color:e==="admin"?"geekblue":e==="editor"?"green":"volcano",children:e},e)},{title:"用户描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",render:(t,e)=>s.jsxs(Q,{children:[s.jsx(h,{type:"primary",shape:"circle",icon:s.jsx(Z,{}),onClick:()=>k(!0,e)}),s.jsx($,{type:"vertical"}),s.jsx(ee,{title:"提示",description:"确定删除？",onConfirm:()=>U(e),okText:"是",cancelText:"否",disabled:e.id==="admin",children:s.jsx(h,{type:"primary",shape:"circle",icon:s.jsx(se,{}),disabled:e.id==="admin"})})]})}];return s.jsxs(q,{className:"userManage",children:[y,s.jsx(X,{title:"用户管理",source:b}),s.jsx(B,{className:"tw-mt-[20px]",title:s.jsx(h,{type:"primary",onClick:()=>k(),children:"新增用户"}),children:s.jsx(_,{columns:E,dataSource:C,pagination:{pageSize:10}})}),s.jsx(Y,{title:c?"编辑":"新增",width:800,open:F,onOk:D,okButtonProps:{loading:v},onCancel:O,children:s.jsxs(l,{className:"tw-mt-[20px]",form:o,name:"user-form",labelCol:{span:4},children:[s.jsx(l.Item,{name:"id",label:"用户ID",rules:[{required:!0}],children:s.jsx(j,{placeholder:"id",disabled:c})}),s.jsx(l.Item,{name:"name",label:"用户名称",rules:[{required:!0}],children:s.jsx(j,{placeholder:"name"})}),s.jsx(l.Item,{name:"role",label:"角色",rules:[{required:!0}],children:s.jsx(A,{placeholder:"role",allowClear:!0,options:[...M],disabled:c})}),s.jsx(l.Item,{name:"description",label:"描述",children:s.jsx(j.TextArea,{placeholder:"description"})})]})})]})}export{ne as default};

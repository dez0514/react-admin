var u=Object.defineProperty;var d=(s,t,e)=>t in s?u(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var r=(s,t,e)=>(d(s,typeof t!="symbol"?t+"":t,e),e);import{r as h,j as a,bf as p}from"./index-a7dd6f78.js";class f{constructor(t){r(this,"opts");r(this,"source");r(this,"output");r(this,"delay");r(this,"chain");r(this,"done");r(this,"timer");this.opts=t||{},this.source=t.source,this.output=t.output,this.delay=t.delay||120,this.chain={parent:null,dom:this.output,val:[]},(!this.opts.done||typeof this.opts.done!="function")&&(this.opts.done=function(){})}init(){this.chain.val=this.convert(this.source,this.chain.val)}convert(t,e){var n;let i=Array.from(t.childNodes);for(let o=0;o<i.length;o++){let l=i[o];if(l.nodeType===3)e=e.concat((n=l==null?void 0:l.nodeValue)==null?void 0:n.split(""));else if(l.nodeType===1){let c=[];c=this.convert(l,c),e.push({dom:l,val:c})}}return e}print(t,e,i){let n=this;this.timer=setTimeout(function(){n.destory(),t.appendChild(document.createTextNode(e)),i()},this.delay)}destory(){this.timer&&clearTimeout(this.timer)}play(t){if(!t.val.length){t.parent?this.play(t.parent):this.opts.done&&this.opts.done();return}let e=t.val.shift();if(typeof e=="string")this.print(t.dom,e,()=>{this.play(t)});else{let i=e.dom.cloneNode();t.dom.appendChild(i),this.play({parent:t,dom:i,val:e.val})}}start(){this.init(),console.log("chain===",this.chain),this.play(this.chain)}}const v=s=>{const{title:t,source:e}=s,i=h.useRef(null),n=h.useRef(null);return h.useEffect(()=>{n.current&&n.current.innerHTML&&(n.current.innerHTML="");const o=new f({source:i.current,output:n.current,delay:30});return console.log("typing===",o),o.destory(),o.start(),()=>{o.destory()}},[t,e]),a.jsxs(p,{bordered:!1,className:"card-item",title:t,children:[a.jsx("div",{style:{display:"none"},ref:i,dangerouslySetInnerHTML:{__html:e}}),a.jsx("div",{ref:n})]})};function g(s){return a.jsx("div",{style:{margin:"20px",...s.style},children:s.children})}export{g as P,v as T};
